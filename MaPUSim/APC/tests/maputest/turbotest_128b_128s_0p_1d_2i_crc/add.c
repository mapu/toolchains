const unsigned int sys[] __attribute__((section (".SDA0.DM0"))) = {
  0xbf8800df,
  0xbd07a993,
  0xbd364586,
  0x3f7fded4,
  0xbfecbe2b,
  0x3f68aa24,
  0xbf14a86e,
  0x3e97942f,
  0xbe7a2acd,
  0x3e3f8692,
  0xbf2afba8,
  0xbfe99169,
  0xbf7391ef,
  0x3f1a1941,
  0xbf934aa0,
  0xbdf02857,
  0x3f502cc1,
  0x3e4d72e2,
  0xbfa2cbeb,
  0x3e17de28,
  0xbf5065f0,
  0x3de1e842,
  0xbeb347e7,
  0xbf2c8b32,
  0xbec00e29,
  0x3facc8c2,
  0xbf0a5261,
  0x3fcaa00b,
  0x3f80df3e,
  0xbfd4510f,
  0xbebf6f51,
  0x3fd6c5e2,
  0xbf38cdc9,
  0x3fa3c443,
  0xbf80db0e,
  0x3f2a72d1,
  0xbf8751d3,
  0xbf3957e2,
  0xbebff0c4,
  0x3f3e925c,
  0x3d806098,
  0xbeafe937,
  0x3fccf01d,
  0xbf853026,
  0xbf9591d9,
  0x3fbfda0e,
  0xbef6aae1,
  0xbf7b183a,
  0xbf1fa4af,
  0xbe4f0787,
  0xbe32f959,
  0x3fc2d433,
  0x3fd6d353,
  0xbf716c80,
  0xbe873896,
  0x3d9922c4,
  0xbf6ef19d,
  0xbf7f8881,
  0x3f5adf29,
  0x3eab0221,
  0x3f44894e,
  0xbefb5d23,
  0xbda7fd43,
  0xbd4fad58,
  0x3d98dd58,
  0x3faef3f7,
  0x3f06ea20,
  0x3d791bd6,
  0x3f2c3bb0,
  0x3fb9cf62,
  0x3f6790dd,
  0xbf81bac2,
  0x3e19ab50,
  0x3c805bfb,
  0xbe36de5a,
  0x3eb3cb1d,
  0x3fbb5ea9,
  0xbda99051,
  0xbff04a49,
  0x3fe724d8,
  0x3ea99043,
  0xbfa1eb68,
  0x3f7c2ba7,
  0x3f700842,
  0x3f285a26,
  0x3f043a58,
  0x3f76439a,
  0x3f91a6b3,
  0xbfc6272c,
  0x3efa1c3d,
  0xbdacd6e9,
  0xbf632aaf,
  0x3e829241,
  0x3f12b862,
  0xbf6e91ae,
  0x3fa245d1,
  0x3f85c1d9,
  0xbf0491ee,
  0x3e677ea0,
  0xbf03408c,
  0xbf9438ce,
  0xbf8513b7,
  0xbf558df9,
  0xbf4cf486,
  0x3d9da99c,
  0x3de0feac,
  0xbef7ee9b,
  0xbfaa515e,
  0xbfe1df34,
  0xbd66ecd1,
  0x3f2fdea9,
  0xbf70afc6,
  0xbf338a61,
  0xbff09b86,
  0xbf0e08a0,
  0xbfa211f1,
  0xbff455a2,
  0xbf82365d,
  0x3f30f1f6,
  0xbf1ecd17,
  0x3f2056a2,
  0xbf5c664b,
  0x3f6c1807,
  0xbee79d54,
  0x3fb276ad,
  0xbf1f35c4,
  0xbfc3c1c4,
  0x3f948b6c,
  0x3ecd6ac4,
  0x3ede6696,
  0x3eb225ef,
  0xbe8611fb,
};
const unsigned int par1[] __attribute__((section (".SDA0.DM0"))) = {
  0xbfaf4e2c,
  0x3fddd97b,
  0x3edf9057,
  0x3f30c208,
  0x3f713770,
  0xbf7138ea,
  0x3ed19b44,
  0x3f57ebc0,
  0xbe73c4f0,
  0x3fc77b4a,
  0x3f581bc2,
  0xbeac9e80,
  0xbe2b3c3d,
  0x3f8fb626,
  0x3f852d2b,
  0xbf34a4b8,
  0x3e312d0a,
  0xbf00862b,
  0xbd866eff,
  0x3f309036,
  0x3f5e45a3,
  0x3f7d0977,
  0x40091397,
  0x3f69759d,
  0xbe2058a1,
  0x3d684884,
  0x3e3b319a,
  0x3f97af0e,
  0xbfc9e9e3,
  0xbe237366,
  0x3df96368,
  0xbf2acd60,
  0x3f2d47fb,
  0x3fdbd814,
  0x3fa529f2,
  0x3f49428e,
  0xbefb7e6b,
  0xbe02223d,
  0xbf8a1dd7,
  0x3f267294,
  0x3f0ccc7c,
  0x3ffdd6ac,
  0xbfb13d04,
  0x3f879d0f,
  0x3ebae237,
  0x3f0fbab9,
  0x3f679c75,
  0xbf162b42,
  0x3edda00a,
  0xbf7d7c8c,
  0x3f655125,
  0xbeb85865,
  0xbf407594,
  0x3f9d0182,
  0xbf703485,
  0x3f7be283,
  0x3e3fcd70,
  0x3ff3ab74,
  0xc0087356,
  0x3f43d394,
  0x3f915c5b,
  0x3e0733ac,
  0xbf967601,
  0xbf34f58a,
  0xbf7e99d8,
  0x3fa8914c,
  0x3f345b79,
  0xbf334f7f,
  0x3ed1f215,
  0x3f2871dc,
  0xbf1ee852,
  0x3e135d2a,
  0xc00c81ed,
  0xbde4cd3f,
  0xbf78ceec,
  0xbfc2332c,
  0xbf6e4528,
  0xbfce6318,
  0xbf91ef47,
  0x3fac57f7,
  0x3f8fad4a,
  0x3effdf5a,
  0x3e15462a,
  0xbee41753,
  0xbe8938e9,
  0x3ec9d96c,
  0xbf819afa,
  0x3f8927a4,
  0x3f80456e,
  0x3ff7d395,
  0x3fb4790a,
  0x3f887317,
  0xbfc91023,
  0xbf769843,
  0x3f28399e,
  0xbf95451c,
  0x3eab9503,
  0x3fce8ed3,
  0x3e113c64,
  0x3e201f51,
  0x3d979676,
  0xbf4655ae,
  0xbf4ea655,
  0x3d1334d7,
  0x3f23e8ef,
  0x3fce7189,
  0x3d0b8875,
  0xbed87329,
  0x3e6f50cc,
  0xbfd4ca5c,
  0x3fcee39f,
  0xbee703be,
  0x3f1aa850,
  0x3f0290b3,
  0x3ecb7096,
  0x3f167d1d,
  0xbeb1c785,
  0xbfc29725,
  0xbfd9867a,
  0xbf8205e4,
  0xbef80173,
  0x3d8c6e3e,
  0xbfe9c73a,
  0x3ea9c733,
  0xbf9d4d5e,
  0x3f4a451b,
  0xbe9d4446,
  0x3f568d09,
  0x3efccde1,
  0x3fc28dc9,
  0xbfbbd5e2,
  0x3f423aa1,
};
const unsigned int par2[] __attribute__((section (".SDA0.DM0"))) = {
  0xbf90477a,
  0x3ffd3fb2,
  0x3e8fc720,
  0x3efb40a4,
  0xbfe3506d,
  0xbf560c15,
  0xbf550957,
  0x3fb40f8f,
  0xbf60b988,
  0x3f14b406,
  0xbf4f25e9,
  0x3f8720ef,
  0xbf0bcbc7,
  0x3fc58318,
  0xbff6acaa,
  0xbfc0e12d,
  0xbeaca198,
  0x3df7b6d9,
  0x3f323418,
  0xbf226ea7,
  0xbe08cc4e,
  0x3fe2324e,
  0xbfbedf31,
  0x3fa8d7c2,
  0x3fb601d1,
  0x3efd0387,
  0x3f8b6601,
  0x3f00a87b,
  0x3fe249ec,
  0x3f8cc60a,
  0x3f1d720c,
  0x3f25a71f,
  0xbde840eb,
  0xbfe8aa57,
  0x3f4ef827,
  0x3e8e7eed,
  0x3e281359,
  0x3f447b97,
  0x3f248e89,
  0x3fcab9b0,
  0xbf8964a2,
  0xbea0af95,
  0x3ee8d99e,
  0xbf0f35f0,
  0xbf14e794,
  0xbf850c6a,
  0xbf1007c6,
  0x3eab2f9b,
  0xbf30551d,
  0xbea340e9,
  0xbf4357c1,
  0x3e14d857,
  0x3d972cc0,
  0x3ed2818c,
  0xbfa42e0d,
  0x3cf949b7,
  0xbfbfeb80,
  0x3ef433ee,
  0xbf997172,
  0xbf32d555,
  0x3edc374c,
  0xbf026ec6,
  0x3e023f6e,
  0x3f8c1f1f,
  0xbf3a36aa,
  0xbf13c259,
  0x3ff45e53,
  0xbf56c2ef,
  0xbde7a3d7,
  0x3f7ff8cb,
  0x3f88aa82,
  0xbf39218e,
  0x3ed4928f,
  0xbf702394,
  0xbea78baf,
  0xbee7731b,
  0xbf556cb7,
  0xbf124e9e,
  0x3e836e7f,
  0xbe9f228b,
  0x3d1be546,
  0xbf8f0404,
  0x3f69763b,
  0xbf232301,
  0xbf76b7b8,
  0x3e3a82e7,
  0x3f61598e,
  0xbf165104,
  0xbfacc8a9,
  0x3d88aea9,
  0xbf21ffbf,
  0x3ea2b397,
  0x3fe93cbc,
  0xbd7f067a,
  0x3e6374db,
  0xbf79659b,
  0x3ef474d5,
  0xbf6a82d8,
  0xbf9bb07e,
  0x3fbf309c,
  0x3f4e9c19,
  0xbe658d63,
  0xbf3e278c,
  0xbde221e8,
  0x3e08aa9e,
  0x3defbfd5,
  0xbfc5b02b,
  0x3fa675c3,
  0x3fb26fef,
  0x3f5d28c4,
  0x3fe3266d,
  0x3e800d3a,
  0x3e9043d1,
  0xbfc96d34,
  0x3badff99,
  0x3f6cf414,
  0x3e509bfd,
  0xbf70a286,
  0x3ee6ffb2,
  0xbfca034e,
  0xbf131b5e,
  0xbe3157f0,
  0xbdf8e38f,
  0xbff0313e,
  0x3f2bd686,
  0xbe6e33e9,
  0xbf589a1d,
  0xbe5f3ff2,
  0xbea0cdb4,
  0x3f1d43f5,
  0xc01c32e8,
  0x3f9c035f,
};
int out[] = {
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
};
const unsigned int beta_initial_value_cb1[] = {
  0x3fc99212,
  0x3f2e07d2,
  0x3f86d129,
  0x3f75f0c4,
  0xbf3d3b78,
  0xbf2589ea,
  0xbff1c57f,
  0xbf7e6eac,
};
const unsigned int beta_initial_value_cb2[] = {
  0xbf6c1606,
  0x3e4a0b1b,
  0x3fb755d1,
  0x404fda97,
  0x3f811000,
  0xbf4e9ebc,
  0xbfc25acd,
  0xc028d39a,
};
void bit2byte(unsigned char *byte_stream, int *bit_stream,
	      unsigned int bit_len) {
  unsigned int i;
  unsigned char tmp = 0x0;
  for (i = 1; i <= bit_len; i++) {
    if (i % 8 != 0)
      tmp |= (*(bit_stream + i - 1) & 0x1) << (8 - i % 8);
    else {
      *(byte_stream + i / 8 - 1) = tmp | (*(bit_stream + i - 1) & 0x1);
      tmp = 0x0;
      }
  }
}
int main()
{
  const unsigned int turbo_base = 0x80000000;
  volatile unsigned int *turbo_addr = (volatile unsigned int *)turbo_base;
  turbo_addr[1] = sys;
  turbo_addr[2] = par1;
  turbo_addr[3] = par2;
  turbo_addr[4] = 0xC00000;
  turbo_addr[5] = 8;  // iter
  turbo_addr[6] = 128; // cb len
  turbo_addr[7] = 128; // sb len
  turbo_addr[8] = 1;   // sb num
  turbo_addr[9] = 128; // sw len1
  turbo_addr[10] = 128;  // sw len2
  turbo_addr[11] = 1;  // sw num
  turbo_addr[12] = 0; // pre len
  *(float*)&turbo_addr[13] = 1.0; // scale
  turbo_addr[14] = 32;  // f2
  turbo_addr[15] = 0; // e1
  turbo_addr[16] = 64; // e2
  for (unsigned i = 0; i < 8; i++)
    turbo_addr[17 + i] = beta_initial_value_cb1[i];
  for (unsigned i = 0; i < 8; i++)
    turbo_addr[25 + i] = beta_initial_value_cb2[i];
  turbo_addr[33] = 47;
  turbo_addr[34] = 0;
  turbo_addr[35] = 0;
  turbo_addr[36] = 0;
  turbo_addr[37] = 0; //crc type
  turbo_addr[38] = 1; //crc switch
  turbo_addr[0] = 1;
  while(turbo_addr[0]);
  const unsigned int out_base = 0xC00000;
  volatile unsigned char *out_addr = (volatile unsigned char *)out_base;
  unsigned char out1[128/8];
  bit2byte(&out1, &out, 128);
  int j = 0;
  for (unsigned i = 0; i < 128/8; i++) {
    if (out_addr[i] != out1[i])
      printf("%d: %x, %x\n", i, out_addr[i], out1[i]);
    else
      j++;
  }
  if (j == 128/8)
    printf("passed!\n");
  return 0;
}

