const unsigned int sys[] __attribute__((section (".SDA0.DM0"))) = {
  0xbe9d3109,
  0xbf0cc38e,
  0xbf779df4,
  0xbfa71e3c,
  0xbf0ccdc9,
  0xbf4f2476,
  0xbeb72cb9,
  0x3f9943dd,
  0xbec81ee1,
  0xbf22042e,
  0x40513070,
  0xbfe5ccce,
  0xbec3d77f,
  0xbf1e1630,
  0xbf298765,
  0x3f251edc,
  0x3f57860d,
  0x3f3070a5,
  0x3f88c035,
  0x3ec93b5a,
  0xbf2b6c15,
  0x3f04fab6,
  0x3f2c9377,
  0xbf1f738c,
  0x3f7d7144,
  0x3fde78f8,
  0x3f4f73a3,
  0xbe81094e,
  0xbf29b778,
  0xbf08db1b,
  0x3f20d899,
  0x4008b92a,
  0x4078f17d,
  0x401d738a,
  0xbf210b70,
  0xbe221b05,
  0xbf93ccd6,
  0x3fce41a7,
  0xbfc8bb9e,
  0xbf01c478,
  0x3ef877bf,
  0xbf2718ec,
  0x3de93747,
  0x3e4f4f4e,
  0xbecb633c,
  0xbf35ef64,
  0x40158604,
  0x3fd4e18b,
  0xbf4fc8ae,
  0x40320cce,
  0xc008ce5e,
  0x3f7c3f9c,
  0x3f8ab782,
  0x3f396a86,
  0x3f628478,
  0xbfa8c003,
  0x3f4eb2f9,
  0x3ee807c7,
  0x3e9d70b3,
  0x3edb2ab2,
  0xbfba750e,
  0x3eea3dbe,
  0xbe506552,
  0xc03aabb0,
  0x3f9aecd5,
  0x3ea55db4,
  0xbc8205e4,
  0xbf05c7bb,
  0xc0095ef9,
  0xbf8a7439,
  0x3faaa6c9,
  0x3f182a61,
  0x3ec000c2,
  0xbfd278bd,
  0x3f880d78,
  0xbfd093e6,
  0xbd028a2f,
  0x3f968182,
  0xbfc96511,
  0x3f249d9a,
  0x3e9d14d0,
  0x3f9f5dce,
  0x3ff6d997,
  0x3ecf39be,
  0xbeb1ca3b,
  0x3eb9668f,
  0xbf8d836e,
  0xbec6be0b,
  0x405f4ba4,
  0xbfcbeb45,
  0x3e082529,
  0x4035560e,
  0x3e434496,
  0x3f03bbc6,
  0xbf101683,
  0x402d1a86,
  0x3fa13a4e,
  0xbf6dfec3,
  0x3fb04afa,
  0x3f47824d,
  0xbfdb3b92,
  0x3f1efb6c,
  0xbf9c2f7e,
  0x3faacd0e,
  0xbf7ec7db,
  0xbf73a417,
  0x3e956ad2,
  0xbf1a69cf,
  0xbf8079aa,
  0x3f5023a3,
  0x3fc38066,
  0x3ebdaf3e,
  0x3fbe1a8f,
  0xc00e79d2,
  0x3fbc227b,
  0x3e076878,
  0xbf9d8c1a,
  0x3f2216cf,
  0x3f9a041f,
  0xbf7c0c60,
  0x3efa2fd5,
  0x3ca8301b,
  0x3fd20755,
  0xbf54bb9e,
  0xbf1a3d23,
  0x3fa91365,
  0xbf3350b6,
  0xbecdd95c,
  0xbeca4043,
  0xc008d459,
  0x3ec00f59,
  0xbfdb16d3,
};
const unsigned int par1[] __attribute__((section (".SDA0.DM0"))) = {
  0xc00b5d2f,
  0x3f250406,
  0x3fd978ca,
  0xbee62d21,
  0xbdd1cc83,
  0x3eb6be1e,
  0x3ed51f4d,
  0xbd063c10,
  0x3d54b364,
  0x4013f90d,
  0xbf8470c4,
  0x3e834f5f,
  0x3ef660e2,
  0x3f806f45,
  0x3f69b0b0,
  0xbf2db115,
  0xbf8f1af2,
  0xbffa083b,
  0xbfc5e64e,
  0x3fab08ba,
  0xbe35552a,
  0xbf196981,
  0xbecaa067,
  0x3f85d2c4,
  0xbed0dd51,
  0x3eb41260,
  0x3f6075d6,
  0xbf95307f,
  0xbd57724e,
  0xbeb60805,
  0x3f2bff17,
  0x3f56ae9c,
  0xbc27300b,
  0x3f5b6d99,
  0x3e60c913,
  0xbf6b5a14,
  0x3ec5883e,
  0xbf9dafee,
  0xbfbcf76c,
  0xbf9def5e,
  0xbd147e68,
  0x3f042c6e,
  0x3c29c093,
  0xbf45afe9,
  0xbf93117c,
  0x3eba0c39,
  0x3f9f79d3,
  0x3e0ff546,
  0x3f2ea935,
  0xbd36bfbe,
  0xbe043567,
  0xbe757e7e,
  0x3f077d0d,
  0xbd5be71e,
  0x3fa023fa,
  0x3f11d6d6,
  0xbf94e794,
  0xbf282552,
  0x3f40bc0e,
  0x3f25b4f5,
  0x3fcb4691,
  0x3ec06f4d,
  0x3fdf4e5e,
  0x3e27a08c,
  0x3fbea726,
  0xbfa2b60f,
  0xbde0369f,
  0x3fbb3cd9,
  0x3ee3285a,
  0xbf938382,
  0x40097ed8,
  0x3fab16d6,
  0x3fe96aec,
  0xbfe2f5dc,
  0x3fb43127,
  0xbf429509,
  0x3f344782,
  0xbea0a76b,
  0xc017cd33,
  0x3f49a141,
  0x3f95f28c,
  0xbfa6f1dd,
  0x3f9fefaa,
  0x3fec1e66,
  0xbfdb085e,
  0xbd53de93,
  0xbdb09150,
  0x3c08b24c,
  0x3f08f7b7,
  0xc00c945b,
  0xbf8df78b,
  0x3e71ffc0,
  0x3fe74e80,
  0xbf1e5f1b,
  0xc0014bd5,
  0xbf955c4c,
  0xbfa80941,
  0xbf3e6484,
  0x3f98a651,
  0xbff4bc88,
  0x3ec87e1f,
  0x3f80e2a4,
  0xbfeb3e2e,
  0x3f56188f,
  0x3ff4ff0e,
  0xc00f9435,
  0x3fa8e86a,
  0x3fc6f8d7,
  0xbef92523,
  0xbfc6d3c2,
  0x3d1013a0,
  0xc040ec17,
  0x3fa09c2e,
  0x3de85a48,
  0xbf08a92b,
  0xbf4e8a8b,
  0x3f62560f,
  0xbfb534bf,
  0xbeeaf8ac,
  0x3f98e8a4,
  0x3bacb357,
  0x3f026f77,
  0x3e3f15ce,
  0x400caa32,
  0x3f802222,
  0xbfef43ed,
  0xbff31b08,
  0xbf826bf7,
  0xbf264917,
  0x3f1a2e03,
  0xbf176daa,
  0x3f607192,
};
const unsigned int par2[] __attribute__((section (".SDA0.DM0"))) = {
  0x3f91291e,
  0xbfa29eb9,
  0x3f829037,
  0x40035e44,
  0x3f0ece8c,
  0xbf1f4e07,
  0x3f2d2957,
  0x3f0c9c5a,
  0x3f78e65c,
  0xbf2ceb0f,
  0x3f28fc6a,
  0xbf54c2a6,
  0xbf09840e,
  0xbdd0f63a,
  0x3f4717ad,
  0x3fcfa4f9,
  0x3f8fd41a,
  0xbfac566a,
  0x401bcf1f,
  0x3efdeb40,
  0xbe841828,
  0x3edc3934,
  0x3fa94111,
  0xbe81a6e6,
  0x3ef2918c,
  0xbf2b6468,
  0x3e4b6b4b,
  0x3ee658b5,
  0x3ebbe246,
  0x3bbb5a8f,
  0xbf043a4f,
  0x3fc5d7b0,
  0xbe29b7bd,
  0x3db26098,
  0xbdc89d3a,
  0x3e6a4860,
  0x3fae8481,
  0x3ff676de,
  0x3f73e269,
  0x3f971c31,
  0x3ff466d9,
  0x40275c28,
  0xbed47629,
  0x3f28da2c,
  0x3faab089,
  0xbffc6a92,
  0x4012c4b4,
  0xbfddd0b3,
  0xbeee4017,
  0x3e4f216d,
  0x3ef8b40d,
  0xbfff0814,
  0xbfad7ce0,
  0xbf8676bc,
  0xbfcca520,
  0x3f152390,
  0xbd28ec2c,
  0xbf2b17ca,
  0x3ecf4aff,
  0xbf1bea1c,
  0xc00ea4f6,
  0x3e938e2b,
  0xbccf7725,
  0xbf3c5a5a,
  0xbf8a7bae,
  0xc0107428,
  0xbe452cb2,
  0x3f011942,
  0x3e120b16,
  0x3f7e37e8,
  0x3f1c2dad,
  0x3eff68b1,
  0xbf8a05ed,
  0x3fd4bbd4,
  0x3da85f46,
  0x40340f65,
  0x3f385ec4,
  0xbfef8e94,
  0x3f8f7476,
  0x3e89a9fa,
  0x3f41dcdb,
  0x401836ea,
  0xbf509c28,
  0x400755e7,
  0x3f4f14ba,
  0x40254ef5,
  0xbf27bd61,
  0x3f3f195f,
  0xbf7aad69,
  0x3fa0f267,
  0x3f22129a,
  0x400f4c55,
  0xbf827195,
  0xbe89d545,
  0x3d9d7297,
  0x3e405087,
  0x3ed7870c,
  0x3eda3099,
  0xbeb7c151,
  0x3f823ee4,
  0xc0077e69,
  0x3fbeaa32,
  0x3ff28d0b,
  0x3ee0a449,
  0x3f70a94c,
  0xbe0fc26c,
  0xbd4f193f,
  0xbf443497,
  0x3e616640,
  0x3f489750,
  0x3cfec5a3,
  0x4008517f,
  0xbec00b91,
  0xbe3d9cc9,
  0x401aa2e9,
  0xbda33a69,
  0x3e91b744,
  0xbfda9404,
  0xbf609e05,
  0x3f8bc140,
  0xbff3d977,
  0x3d89cdae,
  0xc0027a78,
  0x400b0b81,
  0x3fd030b4,
  0xbfdba23c,
  0xbdef2deb,
  0xbe978a5e,
  0x3f356cc9,
  0xbf1b0fc2,
  0xbec2f615,
  0x3f50f91e,
};
int out[] = {
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0x00000001,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0000000000,
  0x00000001,
  0x00000001,
  0000000000,
  0000000000,
  0x00000001,
};
const unsigned int beta_initial_value_cb1[] = {
  0xbf9e8be5,
  0xbe46ba46,
  0x3f15ecf4,
  0x3f5715e9,
  0xbfa5acde,
  0xbfc64159,
  0x3ff94249,
  0x3f671b5a,
};
const unsigned int beta_initial_value_cb2[] = {
  0xbe9da3fe,
  0xbdbb600a,
  0x3fb46782,
  0x40181117,
  0xbf83a9fe,
  0xbfff64a8,
  0xbd95485a,
  0xbe941e12,
};

void bit2byte(unsigned char *byte_stream, int *bit_stream,
	      unsigned int bit_len) {
  unsigned int i;
  unsigned char tmp = 0x0;
  for (i = 1; i <= bit_len; i++) {
    if (i % 8 != 0)
      tmp |= (*(bit_stream + i - 1) & 0x1) << (8 - i % 8);
    else {
      *(byte_stream + i / 8 - 1) = tmp | (*(bit_stream + i - 1) & 0x1);
      tmp = 0x0;
      }
  }
}
int main()
{
  const unsigned int turbo_base = 0x80000000;
  volatile unsigned int *turbo_addr = (volatile unsigned int *)turbo_base;
  turbo_addr[1] = sys;
  turbo_addr[2] = par1;
  turbo_addr[3] = par2;
  turbo_addr[4] = 0xC00000;
  turbo_addr[5] = 8;  // iter
  turbo_addr[6] = 128; // cb len
  turbo_addr[7] = 128; // sb len
  turbo_addr[8] = 1;   // sb num
  turbo_addr[9] = 128; // sw len1
  turbo_addr[10] = 128;  // sw len2
  turbo_addr[11] = 1;  // sw num
  turbo_addr[12] = 0; // pre len
  *(float*)&turbo_addr[13] = 1.0; // scale
  turbo_addr[14] = 32;  // f2
  turbo_addr[15] = 0; // e1
  turbo_addr[16] = 64; // e2
  for (unsigned i = 0; i < 8; i++)
    turbo_addr[17 + i] = beta_initial_value_cb1[i];
  for (unsigned i = 0; i < 8; i++)
    turbo_addr[25 + i] = beta_initial_value_cb2[i];
  turbo_addr[33] = 47;
  turbo_addr[34] = 0;
  turbo_addr[35] = 0;
  turbo_addr[36] = 0;
  turbo_addr[37] = 0; //crc type
  turbo_addr[38] = 1; //crc switch
  turbo_addr[0] = 1;
  while(turbo_addr[0]);
  const unsigned int out_base = 0xC00000;
  volatile unsigned char *out_addr = (volatile unsigned char *)out_base;
  unsigned char out1[128/8];
  bit2byte(&out1, &out, 128);
  int j = 0;
  for (unsigned i = 0; i < 128/8; i++) {
    if (out_addr[i] != out1[i])
      printf("%d: %x, %x\n", i, out_addr[i], out1[i]);
    else
      j++;
  }
  if (j == 128/8)
    printf("passed!\n");
  return 0;
}

